# План реализации системы учета рабочего времени через QR код

Этот документ описывает предварительный план разработки.

## Общая идея

На планшете в клинике отображается текущий QR код, который обновляется каждые 30–60 секунд (по аналогии с Google Authenticator). QR код содержит зашифрованные данные о филиале и времени генерации. Сотрудник через камеру устройства или через мобильный телефон сканирует код и взаимодействует с Telegram‑миниприложением, чтобы отметить приход или уход.

## Основные компоненты

1. **Генератор QR**
   - Запускается на планшете.
   - Каждые N секунд генерирует новый код со штампом времени и ID филиала.
   - Код подписывается или шифруется, чтобы исключить подделку.

2. **Телеграм‑миниприложение**
   - Пользователь открывает миниприложение внутри Telegram.
   - Через него можно зарегистрироваться, сканировать код и выбрать действие «я пришёл» или «я ушёл».
   - Приложение передаёт отсканированный код серверу, который проверяет подпись и время жизни.
   - Событие (приход/уход) сохраняется в базе данных.

3. **База данных**
   - Хранит пользователей, филиалы, события посещений.
   - Возможно хранение ключей для подписи кодов.

## Технологический стек

- **Python 3** для серверной части и миниприложения Telegram.
- Библиотека **python-telegram-bot** для взаимодействия с Telegram.
- **qrcode** для генерации QR кодов.
- **PyNaCl** или встроенный `cryptography` для подписи/шифрования данных.
- **SQLite** или PostgreSQL для хранения записей.

## Поток действий для сотрудника

1. Сотрудник подходит к планшету.
2. На экране отображается QR код с ограниченным временем действия.
3. Сотрудник сканирует код через камеру своего телефона или внутреннее приложение.
4. Миниприложение предлагает выбрать действие «Я пришёл» или «Я ушёл».
5. После нажатия информация заносится в базу данных с точным временем.
6. При необходимости отправляется подтверждение руководителю или в общий чат.

## Требования к безопасности

- Код должен быть действителен не дольше 1 минуты.
- Подпись должна исключать возможность подделки или повторного использования кода.
- Миниприложение проверяет пользователя по Telegram‑ID и связывает его с базой сотрудников.


## Регистрация и выдача прав

- Сотрудник самостоятельно запускает миниприложение и вводит ФИО и номер телефона.
- Эти данные сохраняются в БД, но запись помечается как "неподтверждённая".
- У администратора в том же миниприложении есть раздел для подтверждения новых пользователей.
- После подтверждения аккаунт связывается с Telegram‑ID и получает права в системе.

## Отчёты о посещениях

- Отчёты доступны в миниприложении.
- Администратор может просматривать статистику приходов/уходов и выгружать данные в CSV.

## Хранение резервных ключей

- Ключи для подписи QR кодов хранятся в зашифрованном виде на сервере.
- Рекомендуется периодически делать офлайн‑резервную копию для возможности восстановления при утрате.

